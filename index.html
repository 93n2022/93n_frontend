<!DOCTYPE html>
<html>
  <head>
    <title>93N</title>
    <script src="https://aloycwl.github.io/js/cdn/jquery.min.js"></script>
    <script src="https://aloycwl.github.io/js/cdn/web3.min.js"></script>
    <script src="https://aloycwl.github.io/js/cdn/web3ac.js"></script>
    <style>
      .hide {
        display: none;
      }
      a {
        cursor: pointer;
        color: blue;
        text-decoration: underline;
      }
      input {
        width: 350px;
        cursor: pointer;
        background-color: #eeeeee;
      }
      i {
        font-size: small;
      }
    </style>
  </head>
  <body>
    <a id="connect" onclick="connect()">Connect</a>
    <div id="root" class="hide">
      <h1>Part 1</h1>
      <ol>
        <li>Connect to Rinkeby Test Network</li>
        <li>
          Get test token from faucet as gas fee -
          <a href="https://rinkebyfaucet.com/" target="_blank"
            >https://rinkebyfaucet.com/</a
          >
        </li>
        <li>
          Claim MOCK-USDT to deposit -
          <a onclick="claim()">click here</a>
        </li>
        <li>Your USDT Token: <span id="txtUSDT"></span></li>
        <li>Your 93N Token: <span id="txt93N"></span></li>
      </ol>
      <h1>Part 2</h1>
      <ol>
        <li>Referred by: <span id="txtRB"></span></li>
        <li>Approval to transfer USDT to contract.</li>
        <li>
          10,000 USDT x
          <select id="num">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
          </select>
          in
          <select id="months">
            <option value="3">3</option>
            <option value="6">6</option>
            <option value="7">9</option>
          </select>
          months - <a onclick="deposit()">Deposit</a>
        </li>
        <li><i id="status">Status...</i></li>
        <li>
          Your referral link:
          <a
            id="txtRef"
            onclick="navigator.clipboard.writeText(document.URL+'#'+$(this).val());$('#status').html('Copied')"
            >Click to copy</a
          >
        </li>
      </ol>
      <h1>Part 3</h1>
      <ol>
        <li>Your packages details</li>
        <ul>
          <li>Amount (wallet)</li>
          <li>Rate</li>
          <li>Last claimed</li>
          <li>Expiry + months</li>
        </ul>
        <li>Your level 1 downlines: <span id="lv1"></span></li>
        <li>Your earning history</li>
        <ol id="history"></ol>
      </ol>
      <h1>Part 4</h1>
      <ol>
        <li>Staking test - <a onclick="stake()">click here</a></li>
      </ol>
      <h1>Part 5</h1>
      <ol>
        <li>Coming soon: LIVE coin price from PanCakeSwap testing</li>
      </ol>
    </div>
  </body>
  <script>
    CHAIN = 4;
    CA = '0x00691081759EF9C21199881F45Bec32f381C4128';
    CA2 = '0xA952Fb1E68Cf0688E4C9474aBDE961Ed6b52151E';
    async function display() {
      $('#txtRB').html(_R());
      $('#txtRef').val(acct);
      $('#root').show();
      $('#connect').hide();
    }
    async function deposit() {
      oamt = 10000 * $('#num').val() * 1e18;
      amt = oamt.toLocaleString('fullwide', { useGrouping: false });
      if (oamt > balUSDT) {
        $('#status').html('Insufficient USDT');
        return;
      }
      $('#status').html('Approving...');
      await contract3.methods.approve(CA, amt).send(FA);
      $('#status').html('Depositing...');
      await contract.methods.Deposit(_R(), amt, $('#months').val()).send(FA);
      $('#status').html('Deposited Successfully');
    }
    async function connect() {
      await load(
        [
          {
            inputs: [u3, u1, u1],
            name: 'Deposit',
            outputs: [],
            stateMutability: 'payable',
            type: 'function',
          },
          {
            inputs: [],
            name: 'Staking',
            outputs: [],
            stateMutability: 'nonpayable',
            type: 'function',
          },
          {
            inputs: [u3],
            name: 'getDownlines',
            outputs: [u4, u4, u4],
            stateMutability: 'view',
            type: 'function',
          },
          {
            inputs: [u3],
            name: 'user',
            outputs: [u3, u1, u1, u1, u1, u1],
            stateMutability: 'view',
            type: 'function',
          },
          {
            anonymous: false,
            inputs: [
              {
                indexed: true,
                internalType: 'address',
                name: 'from',
                type: 'address',
              },
              {
                indexed: true,
                internalType: 'address',
                name: 'to',
                type: 'address',
              },
              {
                indexed: false,
                internalType: 'uint256',
                name: 'amount',
                type: 'uint256',
              },
              {
                indexed: true,
                internalType: 'uint256',
                name: 'status',
                type: 'uint256',
              },
            ],
            name: 'Payout',
            type: 'event',
          },
        ],
        CA
      );
      await load2();
      contract3 = new web3.eth.Contract(
        [
          {
            inputs: [u3],
            name: 'balanceOf',
            outputs: [u1],
            stateMutability: 'view',
            type: 'function',
          },
          {
            inputs: [u3, u1],
            name: 'approve',
            outputs: [],
            stateMutability: 'nonpayable',
            type: 'function',
          },
          {
            inputs: [u3],
            name: 'MINT',
            outputs: [],
            stateMutability: 'nonpayable',
            type: 'function',
          },
        ],
        '0x129E44F2157A2819e37924f02eFCfFE2e9d409B9'
      );
      await disUSDT();
      downlines = await contract.methods.getDownlines(acct).call();
      for (i = 0; i < 3; i++) $('#lv' + (i + 1)).html(downlines[i].toString());
      display();
      loadEarnings();
    }

    async function claim() {
      $('#status').html('Minting...');
      await contract3.methods.MINT(acct).send(FA);
      disUSDT();
      $('#status').html('Minted');
    }
    async function disUSDT() {
      balUSDT = (
        (await contract3.methods.balanceOf(acct).call()) / 1e18
      ).toLocaleString('en-US');
      bal93N = await LB();
      $('#txtUSDT').html(balUSDT);
      $('#txt93N').html(bal93N.toLocaleString('en-US'));
    }
    window.ethereum.on('accountsChanged', function (accounts) {
      connect();
    });
    async function loadEarnings() {
      await contract
        .getPastEvents('Payout', {
          filter: { to: acct },
          fromBlock: 0,
          toBlock: 'latest',
        })
        .then((events) => {
          str = '';
          events.forEach((event) => {
            e = event.returnValues;
            str += `<li>${e.from} (${e.status}) => ${(
              e.amount / 1e18
            ).toLocaleString('en-US')}</li>`;
          });
          $('#history').html(str);
        });
    }
    async function stake() {
      $('#status').html('Staking...');
      await contract.methods.Staking().send(FA);
      $('#status').html('Done');
    }
  </script>
</html>
